{"version":3,"sources":["webpack:///./src/components/compliance/ComplianceRatioBranch.vue","webpack:///src/components/compliance/ComplianceRatioBranch.vue","webpack:///./src/components/compliance/ComplianceRatioBranch.vue?aae0","webpack:///./src/components/compliance/ComplianceRatioBranch.vue?fed1"],"names":["_c","attrs","departments","model","value","_vm","callback","expression","selectedClassification","scopedSlots","fn","menuMonth","staticClass","selectedDept","tableRows","staticStyle","_v","exportExcel","tableHeaders","key","idx","style","isSummary","staticRenderFns","render","name","data","selectedMonth","classificationOptions","reportData","totals","complied","notComplied","total","exporting","noDataMessage","watch","val","loadClassifications","computed","monthTitle","m","dt","format","dObj","Date","monthName","toLocaleString","month","toUpperCase","year","getFullYear","Array","isArray","length","map","row","branch","percent","methods","res","axios","get","apiConfig","baseURL","id","sort","a","b","localeCompare","deptId","subCode","filter","c","params","moment","classificationId","processReportData","_this$departments$fin","_this$classificationO","deptName","find","d","className","monthStr","err","message","url","URLSearchParams","toString","window","open","$emit","forEach","mounted","loadDepartments","component"],"mappings":"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","file":"js/chunk-2d0d5c1f.dad445ed.js","sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('v-card',{staticClass:\"pa-4\"},[_c('h2',[_vm._v(\"Compliance Ratio (By Branch & Department)\")]),_c('v-row',{attrs:{\"dense\":\"\"}},[_c('v-col',{attrs:{\"cols\":\"12\",\"md\":\"3\"}},[_c('v-autocomplete',{attrs:{\"items\":_vm.departments,\"item-text\":\"name\",\"item-value\":\"id\",\"label\":\"Department\",\"dense\":\"\",\"required\":\"\"},model:{value:(_vm.selectedDept),callback:function ($$v) {_vm.selectedDept=$$v},expression:\"selectedDept\"}})],1),_c('v-col',{attrs:{\"cols\":\"12\",\"md\":\"3\"}},[_c('v-autocomplete',{attrs:{\"items\":_vm.classificationOptions,\"item-text\":\"subCode\",\"item-value\":\"id\",\"label\":\"File Classification\",\"dense\":\"\",\"disabled\":!_vm.selectedDept,\"clearable\":\"\"},model:{value:(_vm.selectedClassification),callback:function ($$v) {_vm.selectedClassification=$$v},expression:\"selectedClassification\"}})],1),_c('v-col',{attrs:{\"cols\":\"12\",\"md\":\"3\"}},[_c('v-menu',{attrs:{\"close-on-content-click\":false},scopedSlots:_vm._u([{key:\"activator\",fn:function({ on, attrs }){return [_c('v-text-field',_vm._g(_vm._b({attrs:{\"label\":\"Month\",\"prepend-icon\":\"mdi-calendar\",\"readonly\":\"\",\"dense\":\"\",\"required\":\"\"},model:{value:(_vm.selectedMonth),callback:function ($$v) {_vm.selectedMonth=$$v},expression:\"selectedMonth\"}},'v-text-field',attrs,false),on))]}}]),model:{value:(_vm.menuMonth),callback:function ($$v) {_vm.menuMonth=$$v},expression:\"menuMonth\"}},[_c('v-date-picker',{attrs:{\"type\":\"month\"},on:{\"change\":function($event){_vm.menuMonth = false}},model:{value:(_vm.selectedMonth),callback:function ($$v) {_vm.selectedMonth=$$v},expression:\"selectedMonth\"}})],1)],1),_c('v-col',{staticClass:\"d-flex align-end\",attrs:{\"cols\":\"12\",\"md\":\"3\"}},[_c('v-btn',{attrs:{\"color\":\"primary\",\"disabled\":!_vm.selectedDept || !_vm.selectedMonth},on:{\"click\":_vm.generateReport}},[_vm._v(\" Generate Report \")])],1)],1),_c('v-divider',{staticClass:\"my-4\"}),(_vm.tableRows.length)?_c('div',[_c('div',{staticClass:\"mb-2\"},[_c('div',{staticStyle:{\"background\":\"#92d050\",\"font-family\":\"Tahoma\",\"font-size\":\"1.1rem\",\"font-weight\":\"bold\",\"text-align\":\"center\",\"padding\":\"8px\",\"border-radius\":\"4px\"}},[_vm._v(\" COMPLIANCE SUMMARY \"+_vm._s(_vm.monthTitle)+\" \")]),_c('div',{staticStyle:{\"background\":\"#ededed\",\"font-family\":\"Tahoma\",\"font-size\":\"0.95rem\",\"text-align\":\"center\",\"padding\":\"6px\",\"border-radius\":\"4px\"}},[_vm._v(\" Assignment Ratio by Branch, \"),_c('span',{staticStyle:{\"font-weight\":\"bold\"}},[_vm._v(\" \"+_vm._s(_vm.selectedDept === \"all\" || !_vm.selectedDept ? \"All Departments\" : _vm.departments.find((d) => d.id === _vm.selectedDept)?.name || \"Department\")+\" \")]),_vm._v(\" , \"),_c('span',{staticStyle:{\"font-weight\":\"bold\"}},[_vm._v(\" \"+_vm._s(_vm.selectedClassification === \"all\" || !_vm.selectedClassification ? \"All Classifications\" : _vm.classificationOptions.find( (c) => c.id === _vm.selectedClassification )?.subCode || \"Classification\")+\" \")])]),_c('div',{staticStyle:{\"background\":\"#fffbe6\",\"color\":\"#856404\",\"font-family\":\"Tahoma\",\"font-size\":\"0.95rem\",\"text-align\":\"center\",\"padding\":\"6px\",\"border-radius\":\"4px\",\"margin-top\":\"6px\"}},[_vm._v(\" For detailed breakdown by department and classification, please click \"),_c('strong',[_vm._v(\"Export to Excel\")]),_vm._v(\". \")]),_c('div',{staticStyle:{\"background\":\"#e6f7ff\",\"color\":\"#00529b\",\"font-family\":\"Tahoma\",\"font-size\":\"1.05rem\",\"text-align\":\"center\",\"padding\":\"8px\",\"border-radius\":\"4px\",\"margin-top\":\"10px\",\"font-weight\":\"bold\"}},[_vm._v(\" OVERALL RATIO: \"+_vm._s(_vm.totals.total > 0 ? ((_vm.totals.complied / _vm.totals.total) * 100).toFixed(2) : \"0.00\")+\"% \")])]),_c('v-btn',{staticClass:\"mb-4\",attrs:{\"color\":\"success\",\"loading\":_vm.exporting},on:{\"click\":_vm.exportExcel}},[_c('v-icon',{attrs:{\"left\":\"\"}},[_vm._v(\"mdi-file-excel\")]),_vm._v(\" Export to Excel \")],1),_c('v-simple-table',[_c('thead',[_c('tr',{staticStyle:{\"background\":\"#ededed\"}},_vm._l((_vm.tableHeaders),function(header){return _c('th',{key:header,staticStyle:{\"font-family\":\"Tahoma\",\"font-size\":\"13px\",\"font-weight\":\"bold\",\"text-transform\":\"uppercase\",\"text-align\":\"center\",\"border\":\"1px solid #bbb\"}},[_vm._v(\" \"+_vm._s(header)+\" \")])}),0)]),_c('tbody',_vm._l((_vm.tableRows),function(row,idx){return _c('tr',{key:idx,style:(row.isSummary\n              ? 'font-family:Tahoma;font-size:13px;font-weight:bold;background:#fff;border:1px solid #bbb;'\n              : 'font-family:Tahoma;font-size:13px;background:#fff;border:1px solid #bbb;')},[_c('td',{style:(row.isSummary\n                ? 'text-align:left;font-weight:bold;'\n                : 'text-align:left;')},[_vm._v(\" \"+_vm._s(row.branch)+\" \")]),_c('td',{staticStyle:{\"text-align\":\"center\",\"font-weight\":\"bold\"}},[_vm._v(\" \"+_vm._s(row.complied)+\" \")]),_c('td',{staticStyle:{\"text-align\":\"center\",\"font-weight\":\"bold\",\"color\":\"#f00\"}},[_vm._v(\" \"+_vm._s(row.notComplied)+\" \")]),_c('td',{staticStyle:{\"text-align\":\"center\",\"font-weight\":\"bold\"}},[_vm._v(\" \"+_vm._s(row.total)+\" \")]),_c('td',{staticStyle:{\"text-align\":\"center\",\"font-weight\":\"bold\"}},[_vm._v(\" \"+_vm._s(row.percent)+\" \")])])}),0)])],1):(_vm.noDataMessage)?_c('v-alert',{staticClass:\"mt-4\",attrs:{\"type\":\"warning\",\"outlined\":\"\"}},[_vm._v(\" \"+_vm._s(_vm.noDataMessage)+\" \")]):_c('v-alert',{staticClass:\"mt-4\",attrs:{\"type\":\"info\",\"outlined\":\"\"}},[_vm._v(\" Please select filters and click \\\"Generate Report\\\" to view data. \")])],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <v-card class=\"pa-4\">\r\n    <h2>Compliance Ratio (By Branch & Department)</h2>\r\n    <v-row dense>\r\n      <v-col cols=\"12\" md=\"3\">\r\n        <v-autocomplete\r\n          v-model=\"selectedDept\"\r\n          :items=\"departments\"\r\n          item-text=\"name\"\r\n          item-value=\"id\"\r\n          label=\"Department\"\r\n          dense\r\n          required\r\n        />\r\n      </v-col>\r\n      <v-col cols=\"12\" md=\"3\">\r\n        <v-autocomplete\r\n          v-model=\"selectedClassification\"\r\n          :items=\"classificationOptions\"\r\n          item-text=\"subCode\"\r\n          item-value=\"id\"\r\n          label=\"File Classification\"\r\n          dense\r\n          :disabled=\"!selectedDept\"\r\n          clearable\r\n        />\r\n      </v-col>\r\n      <v-col cols=\"12\" md=\"3\">\r\n        <v-menu v-model=\"menuMonth\" :close-on-content-click=\"false\">\r\n          <template v-slot:activator=\"{ on, attrs }\">\r\n            <v-text-field\r\n              v-model=\"selectedMonth\"\r\n              label=\"Month\"\r\n              prepend-icon=\"mdi-calendar\"\r\n              readonly\r\n              v-bind=\"attrs\"\r\n              v-on=\"on\"\r\n              dense\r\n              required\r\n            />\r\n          </template>\r\n          <v-date-picker\r\n            v-model=\"selectedMonth\"\r\n            type=\"month\"\r\n            @change=\"menuMonth = false\"\r\n          />\r\n        </v-menu>\r\n      </v-col>\r\n      <v-col cols=\"12\" md=\"3\" class=\"d-flex align-end\">\r\n        <v-btn\r\n          color=\"primary\"\r\n          @click=\"generateReport\"\r\n          :disabled=\"!selectedDept || !selectedMonth\"\r\n        >\r\n          Generate Report\r\n        </v-btn>\r\n      </v-col>\r\n    </v-row>\r\n    <v-divider class=\"my-4\" />\r\n    <div v-if=\"tableRows.length\">\r\n      <!-- Title and subtitle rows -->\r\n      <div class=\"mb-2\">\r\n        <div\r\n          style=\"\r\n            background: #92d050;\r\n            font-family: Tahoma;\r\n            font-size: 1.1rem;\r\n            font-weight: bold;\r\n            text-align: center;\r\n            padding: 8px;\r\n            border-radius: 4px;\r\n          \"\r\n        >\r\n          COMPLIANCE SUMMARY {{ monthTitle }}\r\n        </div>\r\n        <div\r\n          style=\"\r\n            background: #ededed;\r\n            font-family: Tahoma;\r\n            font-size: 0.95rem;\r\n            text-align: center;\r\n            padding: 6px;\r\n            border-radius: 4px;\r\n          \"\r\n        >\r\n          Assignment Ratio by Branch,\r\n          <span style=\"font-weight: bold\">\r\n            {{\r\n              selectedDept === \"all\" || !selectedDept\r\n                ? \"All Departments\"\r\n                : departments.find((d) => d.id === selectedDept)?.name ||\r\n                  \"Department\"\r\n            }}\r\n          </span>\r\n          ,\r\n          <span style=\"font-weight: bold\">\r\n            {{\r\n              selectedClassification === \"all\" || !selectedClassification\r\n                ? \"All Classifications\"\r\n                : classificationOptions.find(\r\n                    (c) => c.id === selectedClassification\r\n                  )?.subCode || \"Classification\"\r\n            }}\r\n          </span>\r\n        </div>\r\n        <div\r\n          style=\"\r\n            background: #fffbe6;\r\n            color: #856404;\r\n            font-family: Tahoma;\r\n            font-size: 0.95rem;\r\n            text-align: center;\r\n            padding: 6px;\r\n            border-radius: 4px;\r\n            margin-top: 6px;\r\n          \"\r\n        >\r\n          For detailed breakdown by department and classification, please click\r\n          <strong>Export to Excel</strong>.\r\n        </div>\r\n        <!-- OVERALL RATIO -->\r\n        <div\r\n          style=\"\r\n            background: #e6f7ff;\r\n            color: #00529b;\r\n            font-family: Tahoma;\r\n            font-size: 1.05rem;\r\n            text-align: center;\r\n            padding: 8px;\r\n            border-radius: 4px;\r\n            margin-top: 10px;\r\n            font-weight: bold;\r\n          \"\r\n        >\r\n          OVERALL RATIO:\r\n          {{\r\n            totals.total > 0\r\n              ? ((totals.complied / totals.total) * 100).toFixed(2)\r\n              : \"0.00\"\r\n          }}%\r\n        </div>\r\n      </div>\r\n      <v-btn\r\n        color=\"success\"\r\n        class=\"mb-4\"\r\n        @click=\"exportExcel\"\r\n        :loading=\"exporting\"\r\n      >\r\n        <v-icon left>mdi-file-excel</v-icon>\r\n        Export to Excel\r\n      </v-btn>\r\n      <v-simple-table>\r\n        <thead>\r\n          <tr style=\"background: #ededed\">\r\n            <th\r\n              v-for=\"header in tableHeaders\"\r\n              :key=\"header\"\r\n              style=\"\r\n                font-family: Tahoma;\r\n                font-size: 13px;\r\n                font-weight: bold;\r\n                text-transform: uppercase;\r\n                text-align: center;\r\n                border: 1px solid #bbb;\r\n              \"\r\n            >\r\n              {{ header }}\r\n            </th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr\r\n            v-for=\"(row, idx) in tableRows\"\r\n            :key=\"idx\"\r\n            :style=\"\r\n              row.isSummary\r\n                ? 'font-family:Tahoma;font-size:13px;font-weight:bold;background:#fff;border:1px solid #bbb;'\r\n                : 'font-family:Tahoma;font-size:13px;background:#fff;border:1px solid #bbb;'\r\n            \"\r\n          >\r\n            <td\r\n              :style=\"\r\n                row.isSummary\r\n                  ? 'text-align:left;font-weight:bold;'\r\n                  : 'text-align:left;'\r\n              \"\r\n            >\r\n              {{ row.branch }}\r\n            </td>\r\n            <td style=\"text-align: center; font-weight: bold\">\r\n              {{ row.complied }}\r\n            </td>\r\n            <td style=\"text-align: center; font-weight: bold; color: #f00\">\r\n              {{ row.notComplied }}\r\n            </td>\r\n            <td style=\"text-align: center; font-weight: bold\">\r\n              {{ row.total }}\r\n            </td>\r\n            <td style=\"text-align: center; font-weight: bold\">\r\n              {{ row.percent }}\r\n            </td>\r\n          </tr>\r\n        </tbody>\r\n      </v-simple-table>\r\n    </div>\r\n    <v-alert v-else-if=\"noDataMessage\" type=\"warning\" outlined class=\"mt-4\">\r\n      {{ noDataMessage }}\r\n    </v-alert>\r\n    <v-alert v-else type=\"info\" outlined class=\"mt-4\">\r\n      Please select filters and click \"Generate Report\" to view data.\r\n    </v-alert>\r\n  </v-card>\r\n</template>\r\n\r\n<script>\r\nimport axios from \"axios\";\r\nimport moment from \"moment\";\r\nimport { apiConfig } from \"../../config/api.config\";\r\n\r\nexport default {\r\n  name: \"ComplianceRatioBranch\",\r\n  data() {\r\n    return {\r\n      selectedDept: null,\r\n      selectedClassification: null,\r\n      selectedMonth: null,\r\n      menuMonth: false,\r\n      departments: [],\r\n      classificationOptions: [],\r\n      reportData: [],\r\n      totals: {\r\n        complied: 0,\r\n        notComplied: 0,\r\n        total: 0,\r\n      },\r\n      exporting: false,\r\n      noDataMessage: \"\",\r\n    };\r\n  },\r\n  watch: {\r\n    selectedDept(val) {\r\n      this.loadClassifications(val);\r\n    },\r\n  },\r\n  computed: {\r\n    monthTitle() {\r\n      if (!this.selectedMonth) return \"\";\r\n      const m = this.selectedMonth;\r\n      const dt = typeof m === \"string\" ? m : m.format(\"YYYY-MM\");\r\n      const dObj = new Date(dt + \"-01\");\r\n      const monthName = dObj\r\n        .toLocaleString(\"default\", { month: \"long\" })\r\n        .toUpperCase();\r\n      const year = dObj.getFullYear();\r\n      return `${monthName} ${year}`;\r\n    },\r\n    tableHeaders() {\r\n      return [\"Branch\", \"Complied\", \"Not Complied\", \"Total\", \"Complied (%)\"];\r\n    },\r\n    tableRows() {\r\n      // Build rows to match Excel export: summary row for each branch, then detail rows\r\n      if (!Array.isArray(this.reportData) || this.reportData.length === 0)\r\n        return [];\r\n      // Map backend branch data to frontend table\r\n      return this.reportData.map((row) => ({\r\n        branch: row.branch,\r\n        complied: row.complied,\r\n        notComplied: row.notComplied,\r\n        total: row.total,\r\n        percent: row.percent,\r\n        isSummary: true,\r\n      }));\r\n    },\r\n  },\r\n  methods: {\r\n    async loadDepartments() {\r\n      const res = await axios.get(`${apiConfig.baseURL}/depts`);\r\n      this.departments = [\r\n        { id: \"all\", name: \"All Departments\" },\r\n        ...res.data.sort((a, b) => a.name.localeCompare(b.name)),\r\n      ];\r\n    },\r\n    async loadClassifications(deptId) {\r\n      if (!deptId || deptId === \"all\") {\r\n        this.classificationOptions = [\r\n          { id: \"all\", subCode: \"All Classifications\" },\r\n        ];\r\n        return;\r\n      }\r\n      const res = await axios.get(\r\n        `${apiConfig.baseURL}/subDepts?deptId=${deptId}`\r\n      );\r\n      this.classificationOptions = [\r\n        { id: \"all\", subCode: \"All Classifications\" },\r\n        ...res.data\r\n          .filter((c) => c.deptId === deptId)\r\n          .sort((a, b) => a.subCode.localeCompare(b.subCode)),\r\n      ];\r\n    },\r\n    async generateReport() {\r\n      this.reportData = [];\r\n      this.totals = { complied: 0, notComplied: 0, total: 0 };\r\n      this.noDataMessage = \"\";\r\n\r\n      try {\r\n        const params = {\r\n          month: this.selectedMonth\r\n            ? moment(this.selectedMonth).format(\"YYYY-MM\")\r\n            : \"\",\r\n          deptId: this.selectedDept || \"all\",\r\n          classificationId: this.selectedClassification || \"all\",\r\n        };\r\n        // Use the compliance ratio branch endpoint\r\n        const res = await axios.get(\r\n          `${apiConfig.baseURL}/compliance/ratio-branch`,\r\n          { params }\r\n        );\r\n        this.processReportData(res.data);\r\n        if (\r\n          !Array.isArray(res.data.reportData) ||\r\n          res.data.reportData.length === 0\r\n        ) {\r\n          const deptName =\r\n            this.departments.find((d) => d.id === this.selectedDept)?.name ||\r\n            \"selected department\";\r\n          const className =\r\n            this.selectedClassification === \"all\"\r\n              ? \"all classifications\"\r\n              : this.classificationOptions.find(\r\n                  (c) => c.id === this.selectedClassification\r\n                )?.subCode || \"selected classification\";\r\n          const monthStr = moment(this.selectedMonth).format(\"MMMM YYYY\");\r\n          this.noDataMessage = `No compliance data found for ${deptName} and ${className} in ${monthStr}.`;\r\n        }\r\n      } catch (err) {\r\n        this.noDataMessage =\r\n          err.message || \"Failed to fetch report data. Please try again.\";\r\n      }\r\n    },\r\n    async exportExcel() {\r\n      this.exporting = true;\r\n      try {\r\n        const params = {\r\n          month: moment(this.selectedMonth).format(\"YYYY-MM\"),\r\n          deptId: this.selectedDept,\r\n          classificationId: this.selectedClassification,\r\n        };\r\n        // Change endpoint to ratio-branch/export\r\n        const url =\r\n          `${apiConfig.baseURL}/compliance/ratio-branch/export?` +\r\n          new URLSearchParams(params).toString();\r\n        window.open(url, \"_blank\");\r\n      } catch (err) {\r\n        this.$emit(\"error\", err.message || \"Failed to export Excel\");\r\n      } finally {\r\n        this.exporting = false;\r\n      }\r\n    },\r\n    processReportData(data) {\r\n      // Process and transform the report data from the API\r\n      this.reportData = data.reportData || [];\r\n\r\n      // Calculate totals\r\n      const totals = { complied: 0, notComplied: 0, total: 0 };\r\n      this.reportData.forEach((row) => {\r\n        totals.complied += row.complied;\r\n        totals.notComplied += row.notComplied;\r\n        totals.total += row.total;\r\n      });\r\n      this.totals = totals;\r\n    },\r\n  },\r\n  mounted() {\r\n    this.loadDepartments();\r\n  },\r\n};\r\n</script>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ComplianceRatioBranch.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ComplianceRatioBranch.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./ComplianceRatioBranch.vue?vue&type=template&id=537e65af\"\nimport script from \"./ComplianceRatioBranch.vue?vue&type=script&lang=js\"\nexport * from \"./ComplianceRatioBranch.vue?vue&type=script&lang=js\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}